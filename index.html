<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora Legendaria ðŸ’¸</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:linear-gradient(135deg,#ff6f61,#ffb3a7);
      display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:15px;color:#333;overflow:hidden
    }
    .container{
      background:#fff;padding:30px;border-radius:20px;
      box-shadow:0 12px 24px rgba(0,0,0,.2);
      max-width:520px;width:100%;text-align:center;position:relative;overflow:hidden;
      transition:background .5s ease
    }
    h2{color:#c2185b;margin-bottom:20px;font-size:2rem;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,.08)}
    label{display:block;margin-bottom:10px;font-size:1.05rem;color:#444}
    input[type="number"]{
      width:100%;padding:14px;font-size:1.1rem;border:2px solid #ff8a80;border-radius:12px;outline:none;
      transition:border-color .3s,box-shadow .3s
    }
    input[type="number"]:focus{border-color:#c2185b;box-shadow:0 0 10px rgba(194,24,91,.25)}
    button{
      background:#c2185b;color:#fff;border:none;padding:14px 22px;border-radius:12px;font-size:1.1rem;cursor:pointer;width:100%;
      margin-top:16px;box-shadow:0 4px 8px rgba(0,0,0,.2);transition:background .25s,transform .15s
    }
    button:hover{background:#8e0038}
    button:active{transform:scale(.98)}
    .button-pulse{animation:pulse .6s ease-out}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

    /* Tarjeta de resultados clara y legible */
    #resultado{
      margin-top:18px; opacity:0;
    }
    .result-card{
      text-align:left; background:#f8fafc; border:1px solid #e2e8f0; border-radius:14px; padding:16px;
      box-shadow:0 6px 16px rgba(0,0,0,.08);
    }
    .row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #e5e7eb}
    .row:last-child{border-bottom:none}
    .label{color:#334155;font-weight:600}
    .value{color:#0f766e;font-weight:700}
    .total .label{color:#0f172a}
    .total .value{color:#0b5d56;font-size:1.15rem}

    /* Animaciones existentes */
    .result-show{animation:fadeInBounce .6s ease-out forwards}
    @keyframes fadeInBounce{0%{opacity:0;transform:translateY(12px)}70%{opacity:1;transform:translateY(-3px)}100%{opacity:1;transform:translateY(0)}}
    .slot-machine{animation:slotSpin .7s ease-in-out;filter:blur(1px)}
    @keyframes slotSpin{0%{transform:translateY(-10px);opacity:.6}50%{transform:translateY(10px);opacity:.85}100%{transform:translateY(0);opacity:1;filter:blur(0)}}
    .vibrate{animation:vibrate .25s ease}
    @keyframes vibrate{0%,100%{transform:translateX(0)}25%{transform:translateX(-3px)}50%{transform:translateX(3px)}75%{transform:translateX(-2px)}}
    .sparkles::before,.sparkles::after{
      content:'';position:absolute;background:radial-gradient(circle,rgba(255,215,0,.8),transparent);
      border-radius:50%;opacity:0;animation:sparkle .8s ease-out forwards
    }
    .sparkles::before{width:18px;height:18px;top:-8px;left:12%}
    .sparkles::after{width:14px;height:14px;bottom:-8px;right:14%}
    @keyframes sparkle{0%{opacity:.9;transform:scale(0)}100%{opacity:0;transform:scale(1.4)}}

    @media (max-width:520px){
      .container{padding:22px}
      h2{font-size:1.6rem}
    }
  </style>

  <!-- LibrerÃ­as (defer) -->
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

  <script>
    // ======= Audio (opcional) =======
    let cashRegisterSynth, noiseSynth, audioReady = false;
    async function startAudio(){
      if (audioReady) return;
      try{
        await Tone.start();
        cashRegisterSynth = new Tone.MetalSynth({
          frequency:200, envelope:{attack:0.001,decay:0.2,release:0.1},
          harmonicity:3.1, modulationIndex:23, resonance:4000, octaves:1.5, volume:-8
        }).toDestination();
        noiseSynth = new Tone.NoiseSynth({
          volume:-18, envelope:{attack:0.005,decay:0.1,release:0.05}
        }).toDestination();
        audioReady = true;
      }catch(e){ console.warn('Audio bloqueado/no disponible:', e); }
    }

    // ======= Formateador MXN =======
    const MXN = new Intl.NumberFormat('es-MX',{ style:'currency', currency:'MXN', minimumFractionDigits:2, maximumFractionDigits:2 });

    // ======= CÃ¡lculo correcto =======
    function calcular(){
      const input = document.getElementById('valorBase');
      const out   = document.getElementById('resultado');
      const btn   = document.getElementById('calculateButton');
      const container = document.getElementById('container');

      const X = parseFloat(input.value);
      if (!Number.isFinite(X) || X < 0){
        out.innerHTML = '';
        out.style.opacity = 1;
        out.className = '';
        out.textContent = 'Ingresa una cantidad vÃ¡lida';
        return;
      }

      // 1) Restar IVA 16%
      const ivaDescontado = X * 0.16;
      const baseSinIVA    = X - ivaDescontado;

      // 2) Restar 3% sobre la base ya sin IVA
      const descuento3 = baseSinIVA * 0.03;

      // 3) Subtotal despuÃ©s de ambos descuentos
      const subTotal = baseSinIVA - descuento3;

      // 4) Mitad para cada socio
      const porSocio = subTotal / 2;

      // Sonidos + confetti (opcionales)
      try{
        if (audioReady){
          cashRegisterSynth?.triggerAttackRelease("C4","8n");
          noiseSynth?.triggerAttackRelease("8n");
        }
        confetti({ particleCount:100, spread:70, origin:{ y:0.6 }, colors:['#ff6f61','#ffb3a7','#c2185b','#00796b'] });
      }catch(e){}

      // Fondo dinÃ¡mico suave
      const colors = ['#f8bbd0','#b2ebf2','#c8e6c9','#fff9c4','#d1c4e9'];
      container.style.background = colors[Math.floor(Math.random()*colors.length)];

      // Pintar resultado claro y legible
      out.innerHTML = `
        <div class="result-card sparkles">
          <div class="row"><span class="label">Cantidad Depositada:</span><span class="value">${MXN.format(X)}</span></div>
          <div class="row"><span class="label">IVA descontado (16%):</span><span class="value">-${MXN.format(ivaDescontado)}</span></div>
          <div class="row"><span class="label">3% Descontado:</span><span class="value">-${MXN.format(descuento3)}</span></div>
          <div class="row total"><span class="label">Sub Total:</span><span class="value">${MXN.format(subTotal)}</span></div>
          <div class="row total"><span class="label">Le toca a cada uno de los Socios:</span><span class="value">${MXN.format(porSocio)}</span></div>
        </div>
      `;

      // Animaciones/visibilidad
      out.classList.remove('slot-machine','vibrate','result-show');
      void out.offsetWidth;
      out.classList.add('slot-machine','vibrate','result-show');
      out.style.opacity = 1;

      // efecto botÃ³n
      btn.classList.remove('button-pulse'); void btn.offsetWidth; btn.classList.add('button-pulse');
    }

    // ======= Enlaces de eventos =======
    window.addEventListener('DOMContentLoaded', ()=>{
      const btn = document.getElementById('calculateButton');
      btn.addEventListener('click', async ()=>{
        await startAudio(); // inicia audio en primer clic (opcional)
        calcular();         // calcula y muestra
      });
    });
  </script>
</head>
<body>
  <div class="container" id="container">
    <h2>Calculadora Legendaria ðŸ’¸</h2>
    <label for="valorBase">Ingresa la cantidad depositada (ej. 53,600.00):</label>
    <input type="number" id="valorBase" value="53600" step="any" />
    <button id="calculateButton">Calcular</button>
    <div id="resultado"></div>
  </div>
</body>
</html>
