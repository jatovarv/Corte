<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora Legendaria $,$</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:linear-gradient(135deg,#ff6f61,#ffb3a7);
      display:flex;justify-content:center;align-items:center;height:100vh;
      margin:0;padding:15px;color:#333;overflow:hidden
    }
    .container{
      background:#fff;padding:30px;border-radius:20px;
      box-shadow:0 12px 24px rgba(0,0,0,.2);
      max-width:450px;width:100%;text-align:center;position:relative;overflow:hidden;
      transition:background .5s ease
    }
    h2{color:#c2185b;margin-bottom:25px;font-size:2em;font-weight:600;text-shadow:0 2px 4px rgba(0,0,0,.1)}
    label{font-size:1.3em;color:#444;display:block;margin-bottom:15px}
    input[type="number"]{
      width:100%;padding:14px;font-size:1.2em;border:2px solid #ff8a80;border-radius:12px;outline:0;
      transition:border-color .3s,box-shadow .3s
    }
    input[type="number"]:focus{border-color:#c2185b;box-shadow:0 0 10px rgba(194,24,91,.4)}
    button{
      background:#c2185b;color:#fff;border:0;padding:15px 25px;font-size:1.3em;border-radius:12px;cursor:pointer;
      transition:background .3s,transform .2s;margin-top:20px;width:100%;box-shadow:0 4px 8px rgba(0,0,0,.2);position:relative;overflow:hidden
    }
    button:hover{background:#8e0038}
    button:active{transform:scale(.95);box-shadow:0 2px 4px rgba(0,0,0,.2)}
    .button-pulse{animation:pulse .6s ease-out}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
    #resultado{
      margin-top:25px;font-size:1.5em;color:#00796b;font-weight:600;background:#e0f7fa;padding:10px;border-radius:10px;
      box-shadow:0 2px 4px rgba(0,0,0,.1);position:relative;min-height:40px;opacity:0
    }
    .result-show{animation:fadeInBounce .8s ease-out forwards}
    @keyframes fadeInBounce{0%{opacity:0;transform:translateY(20px)}70%{opacity:1;transform:translateY(-5px)}100%{opacity:1;transform:translateY(0)}}
    .vibrate{animation:vibrate .3s ease}
    @keyframes vibrate{0%,100%{transform:translateX(0)}20%{transform:translateX(-5px)}40%{transform:translateX(5px)}60%{transform:translateX(-3px)}80%{transform:translateX(3px)}}
    .sparkles::before,.sparkles::after{
      content:'';position:absolute;background:radial-gradient(circle,rgba(255,215,0,.8),transparent);
      border-radius:50%;opacity:0;animation:sparkle .8s ease-out forwards
    }
    .sparkles::before{width:20px;height:20px;top:-10px;left:10%}
    .sparkles::after{width:15px;height:15px;bottom:-10px;right:15%}
    @keyframes sparkle{0%{opacity:.8;transform:scale(0)}100%{opacity:0;transform:scale(1.5)}}
    .slot-machine{animation:slotSpin 1s ease-in-out;filter:blur(2px)}
    @keyframes slotSpin{0%{transform:translateY(-20px);opacity:.5}50%{transform:translateY(20px);opacity:.7}100%{transform:translateY(0);opacity:1;filter:blur(0)}}
    @media (max-width:500px){
      .container{padding:20px}
      h2{font-size:1.6em}
      label,input,button{font-size:1em}
      #resultado{font-size:1.3em}
    }
  </style>
  <!-- Librerías con defer para que el DOM exista antes de ejecutar JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
  <script defer>
    // Estado/audio global
    let cashRegisterSynth, noiseSynth, isAudioContextStarted = false;

    async function startAudioContext(){
      if (isAudioContextStarted) return;
      try{
        await Tone.start();
        isAudioContextStarted = true;
        cashRegisterSynth = new Tone.MetalSynth({
          frequency:200,
          envelope:{attack:0.001,decay:0.2,release:0.1},
          harmonicity:3.1,modulationIndex:23,resonance:4000,octaves:1.5,volume:-8
        }).toDestination();
        noiseSynth = new Tone.NoiseSynth({
          volume:-18,envelope:{attack:0.005,decay:0.1,release:0.05}
        }).toDestination();
      }catch(e){ console.warn("Audio no disponible:", e); }
    }

    function calcular(){
      const input = document.getElementById('valorBase');
      const out   = document.getElementById('resultado');
      const val   = Number(input.value || 0);

      // --- Lógica de cálculo (ajusta a tu fórmula real) ---
      const total = Math.round(val * 1.16);
      // -----------------------------------------------------

      // Sonidos (si el usuario ya interactuó)
      try{ cashRegisterSynth?.triggerAttackRelease("C4","8n"); noiseSynth?.triggerAttackRelease("8n"); }catch(e){}

      // Confetti
      try{ confetti({ particleCount:120, spread:70, origin:{ y:0.3 } }); }catch(e){}

      // Mostrar resultado con animaciones
      out.textContent = `Resultado: ${total.toLocaleString('es-MX')}`;
      out.classList.remove('slot-machine','result-show','vibrate','sparkles');
      void out.offsetWidth; // reinicia animaciones
      out.classList.add('slot-machine','result-show','sparkles');
    }

    // Al cargar el DOM, conectamos el botón
    window.addEventListener('DOMContentLoaded', ()=>{
      const btn = document.getElementById('calculateButton');
      btn.addEventListener('click', async ()=>{
        await startAudioContext();
        calcular();
        btn.classList.remove('button-pulse'); void btn.offsetWidth; btn.classList.add('button-pulse');
      });
    });
  </script>
</head>
<body>
  <div class="container" id="container">
    <h2>Calculadora Legendaria $,$</h2>
    <label for="valorBase">Ingresa el valor base (ej. 53600):</label>
    <input type="number" id="valorBase" value="53600" step="any" />
    <button id="calculateButton">Calcular</button>
    <div id="resultado"></div>
  </div>
</body>
</html>
